<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorecast - Your Beaches</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app"></div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        
        const API_BASE = 'https://shorecast.onrender.com';
        
        // IMPORTANT: Replace these with your actual Supabase project credentials
        const SUPABASE_URL = 'https://kivqldzfitxldzymxcfu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpdnFsZHpmaXR4bGR6eW14Y2Z1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDAzOTcsImV4cCI6MjA4MTAxNjM5N30.TYdgeVZe7mbgeASi8npL82Ewon7b8fjN0jRi1RtZNZk';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const DEFAULT_BEACHES = ['rhossili', 'barry-island', 'tenby-south'];
        const MAX_FREE_BEACHES = 3;
        
        const FALLBACK_TIME_SLOTS = [
            { id: 'now', label: 'right now', time: '--:--' },
            { id: 'tomorrow-am', label: 'tomorrow am', time: '08:00' },
            { id: 'tomorrow-pm', label: 'tomorrow pm', time: '17:00' },
            { id: 'day-after-am', label: 'loading...', time: '08:00' }
        ];
        
        const ARROWS = { 
            north: '‚Üë', south: '‚Üì', east: '‚Üí', west: '‚Üê', 
            northeast: '‚Üó', northwest: '‚Üñ', southeast: '‚Üò', southwest: '‚Üô' 
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================

        let state = {
            // Auth state
            view: 'loading', // loading, login, signup, forgot-password, check-email, reset-sent, onboarding, dashboard, about, faqs, profile, all-beaches, contact, premium
            user: null,
            userProfile: null,
            authError: null,
            authLoading: false,
            
            // Dashboard state
            mode: 'swimming',
            time: 'now',
            data: null,
            loading: true,
            error: null,
            showInfo: null,
            timeSlots: FALLBACK_TIME_SLOTS,
            userBeaches: [],
            
            // Onboarding state
            availableBeaches: [],
            selectedBeaches: [],
            
            // UI state
            showSidebar: false,
            showSettings: false
        };

        function setState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function toggleSidebar() {
            setState({ showSidebar: !state.showSidebar });
        }

        function navigateTo(view) {
            setState({ view, showSidebar: false });
            if (view === 'dashboard') {
                fetchData();
            } else if (view === 'all-beaches' || view === 'profile') {
                loadAvailableBeaches();
            }
        }

        // ============================================
        // AUTH FUNCTIONS
        // ============================================

        async function checkAuth() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session?.user) {
                    setState({ user: session.user });
                    await loadUserProfile();
                } else {
                    setState({ view: 'login', user: null });
                }
            } catch (err) {
                console.error('Auth check failed:', err);
                setState({ view: 'login', user: null });
            }
        }

        async function signUp(email, password, marketingConsent) {
            setState({ authLoading: true, authError: null });
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            marketing_consent: marketingConsent,
                            consent_timestamp: new Date().toISOString()
                        }
                    }
                });
                
                if (error) throw error;
                
                if (data.user && !data.session) {
                    // Email confirmation required
                    setState({ 
                        authLoading: false, 
                        authError: null,
                        view: 'check-email'
                    });
                } else if (data.session) {
                    // Auto-confirmed (development mode)
                    setState({ user: data.user, authLoading: false });
                    await loadUserProfile();
                }
            } catch (err) {
                setState({ authError: err.message, authLoading: false });
            }
        }

        async function signIn(email, password) {
            setState({ authLoading: true, authError: null });
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                setState({ user: data.user, authLoading: false });
                await loadUserProfile();
            } catch (err) {
                setState({ authError: err.message, authLoading: false });
            }
        }

        async function signInWithProvider(provider) {
            setState({ authLoading: true, authError: null });
            
            try {
                const { error } = await supabase.auth.signInWithOAuth({
                    provider,
                    options: {
                        redirectTo: window.location.origin
                    }
                });
                
                if (error) throw error;
            } catch (err) {
                setState({ authError: err.message, authLoading: false });
            }
        }

        async function resetPassword(email) {
            setState({ authLoading: true, authError: null });
            
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: `${window.location.origin}?reset=true`
                });
                
                if (error) throw error;
                
                setState({ 
                    authLoading: false, 
                    view: 'reset-sent'
                });
            } catch (err) {
                setState({ authError: err.message, authLoading: false });
            }
        }

        async function signOut() {
            await supabase.auth.signOut();
            setState({ 
                user: null, 
                userProfile: null, 
                userBeaches: [],
                view: 'login',
                data: null
            });
        }

        // ============================================
        // USER PROFILE & BEACHES
        // ============================================

        async function loadUserProfile() {
            if (!state.user) return;
            
            try {
                // Load user profile
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', state.user.id)
                    .single();
                
                if (profileError && profileError.code !== 'PGRST116') {
                    console.error('Profile load error:', profileError);
                }
                
                // Load user beaches
                const { data: beaches, error: beachesError } = await supabase
                    .from('user_beaches')
                    .select('beach_slug, position')
                    .eq('user_id', state.user.id)
                    .order('position');
                
                if (beachesError) {
                    console.error('Beaches load error:', beachesError);
                }
                
                const userBeaches = beaches?.map(b => b.beach_slug) || [];
                
                if (userBeaches.length === 0) {
                    // New user - show onboarding
                    await loadAvailableBeaches();
                    setState({ 
                        userProfile: profile,
                        userBeaches: [],
                        selectedBeaches: DEFAULT_BEACHES,
                        view: 'onboarding'
                    });
                } else {
                    // Existing user - show dashboard
                    setState({ 
                        userProfile: profile,
                        userBeaches: userBeaches,
                        view: 'dashboard'
                    });
                    fetchData();
                }
            } catch (err) {
                console.error('Failed to load user data:', err);
                setState({ view: 'dashboard', userBeaches: DEFAULT_BEACHES });
                fetchData();
            }
        }

        async function loadAvailableBeaches() {
            try {
                const res = await fetch(`${API_BASE}/locations`);
                const beaches = await res.json();
                setState({ availableBeaches: beaches });
            } catch (err) {
                console.error('Failed to load beaches:', err);
            }
        }

        async function saveUserBeaches(beaches) {
            if (!state.user) return;
            
            try {
                // Delete existing beaches
                await supabase
                    .from('user_beaches')
                    .delete()
                    .eq('user_id', state.user.id);
                
                // Insert new beaches
                const inserts = beaches.map((slug, index) => ({
                    user_id: state.user.id,
                    beach_slug: slug,
                    position: index
                }));
                
                const { error } = await supabase
                    .from('user_beaches')
                    .insert(inserts);
                
                if (error) throw error;
                
                setState({ 
                    userBeaches: beaches,
                    view: 'dashboard'
                });
                fetchData();
            } catch (err) {
                console.error('Failed to save beaches:', err);
                alert('Failed to save your beaches. Please try again.');
            }
        }

        // ============================================
        // DASHBOARD DATA
        // ============================================

        async function fetchData() {
            setState({ loading: true, error: null });
            
            const beaches = state.userBeaches.length > 0 ? state.userBeaches : DEFAULT_BEACHES;
            
            try {
                const url = `${API_BASE}/dashboard?beaches=${beaches.join(',')}&mode=${state.mode}&time=${state.time}`;
                const res = await fetch(url);
                
                if (!res.ok) {
                    throw new Error(`API returned ${res.status}: ${res.statusText}`);
                }
                
                const data = await res.json();
                const newTimeSlots = data.meta?.availableTimeSlots || state.timeSlots;
                
                setState({ data, loading: false, timeSlots: newTimeSlots });
            } catch (err) {
                console.error('API failed:', err.message);
                setState({ error: err.message, loading: false });
            }
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================

        function getUpdateText() {
            if (!state.data?.meta) return '';
            if (state.data.meta.isForecast) return `forecast for ${state.data.meta.timeLabel}`;
            const mins = Math.round((Date.now() - new Date(state.data.meta.updatedAt)) / 60000);
            return mins < 1 ? 'updated just now' : `updated ${mins}m ago`;
        }

        function formatRecommendation(text) {
            return (text || '').replace(/\*\*(.*?)\*\*/g, '<strong class="text-gray-900">$1</strong>');
        }

        function getGradient(slug) {
            const gradients = {
                'rhossili': 'from-slate-400 to-blue-500',
                'barry-island': 'from-slate-300 to-slate-500',
                'tenby-south': 'from-blue-300 to-indigo-400',
                'langland': 'from-cyan-400 to-blue-500',
                'caswell': 'from-teal-400 to-cyan-500',
                'rest-bay': 'from-slate-500 to-indigo-600',
                'porthcawl': 'from-blue-400 to-purple-500'
            };
            return gradients[slug] || 'from-slate-400 to-slate-500';
        }

        function getColors(status) {
            const colors = {
                green: { badge: 'bg-emerald-500', border: 'border-l-emerald-500', bg: 'from-emerald-50 to-green-50' },
                amber: { badge: 'bg-amber-400', border: 'border-l-amber-400', bg: 'from-amber-50 to-yellow-50' },
                red: { badge: 'bg-red-400', border: 'border-l-red-400', bg: 'from-red-50 to-rose-50' }
            };
            return colors[status] || { badge: 'bg-gray-400', border: 'border-l-gray-400', bg: 'from-gray-50 to-gray-100' };
        }

        function getFilteredBeaches(searchTerm = '') {
            const search = searchTerm.toLowerCase();
            return state.availableBeaches.filter(b => 
                b.name.toLowerCase().includes(search) || 
                b.location.toLowerCase().includes(search)
            );
        }

        function updateBeachSearch(value) {
            // Update beach list without triggering full re-render
            const container = document.getElementById('beach-list-container');
            if (!container) return;
            
            const filtered = getFilteredBeaches(value);
            container.innerHTML = filtered.length === 0 ? `
                <p class="text-center text-gray-500 py-8">no beaches found</p>
            ` : filtered.map(beach => {
                const isSelected = state.selectedBeaches.includes(beach.slug);
                const canSelect = state.selectedBeaches.length < MAX_FREE_BEACHES;
                
                return `
                    <button 
                        onclick="toggleBeachSelection('${beach.slug}')"
                        class="w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all ${
                            isSelected 
                                ? 'border-indigo-500 bg-indigo-50' 
                                : canSelect 
                                    ? 'border-gray-200 hover:border-gray-300' 
                                    : 'border-gray-100 opacity-50 cursor-not-allowed'
                        }"
                        ${!isSelected && !canSelect ? 'disabled' : ''}>
                        <div class="text-left">
                            <div class="font-medium text-gray-900">${beach.name}</div>
                            <div class="text-sm text-gray-500">${beach.location}</div>
                        </div>
                        ${isSelected ? `
                            <svg class="w-6 h-6 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        ` : ''}
                    </button>
                `;
            }).join('');
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            signIn(email, password);
        }

        function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const marketing = document.getElementById('signup-marketing').checked;
            signUp(email, password, marketing);
        }

        function handleResetPassword(e) {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            resetPassword(email);
        }

        function toggleBeachSelection(slug) {
            const selected = state.selectedBeaches;
            if (selected.includes(slug)) {
                setState({ selectedBeaches: selected.filter(s => s !== slug) });
            } else if (selected.length < MAX_FREE_BEACHES) {
                setState({ selectedBeaches: [...selected, slug] });
            }
            
            // Update the beach list to reflect selection without losing search input
            const searchInput = document.getElementById('beach-search-input');
            if (searchInput) {
                updateBeachSearch(searchInput.value);
            }
        }

        function startEditingBeaches() {
            loadAvailableBeaches().then(() => {
                setState({ 
                    selectedBeaches: [...state.userBeaches], // Pre-select current beaches
                    view: 'onboarding'
                });
            });
        }

        function completeOnboarding() {
            if (state.selectedBeaches.length === 0) {
                alert('Please select at least one beach');
                return;
            }
            saveUserBeaches(state.selectedBeaches);
        }

        // ============================================
        // RENDER FUNCTIONS - SIDEBAR MENU
        // ============================================

        function renderSidebar() {
            if (!state.showSidebar) return '';
            
            const menuItems = [
                { label: 'your beaches', view: 'dashboard', icon: 'üèñÔ∏è', show: state.user },
                { label: 'all beaches', view: 'all-beaches', icon: 'üó∫Ô∏è', show: true },
                { label: 'your profile', view: 'profile', icon: 'üë§', show: state.user },
                { label: 'about shorecast', view: 'about', icon: '‚ÑπÔ∏è', show: true },
                { label: 'faqs', view: 'faqs', icon: '‚ùì', show: true },
                { label: 'contact us', view: 'contact', icon: '‚úâÔ∏è', show: true },
                { label: 'upgrade to premium', view: 'premium', icon: '‚≠ê', show: state.user }
            ];
            
            return `
                <!-- Overlay -->
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40" onclick="toggleSidebar()"></div>
                
                <!-- Sidebar -->
                <div class="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 overflow-y-auto">
                    <div class="p-6">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-8">
                            <h2 class="text-2xl font-light text-gray-900">menu</h2>
                            <button onclick="toggleSidebar()" 
                                class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 flex items-center justify-center text-xl">
                                √ó
                            </button>
                        </div>
                        
                        <!-- User Info -->
                        ${state.user ? `
                            <div class="mb-8 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">
                                <p class="text-sm text-gray-500 mb-1">signed in as</p>
                                <p class="font-medium text-gray-900 truncate">${state.user.email}</p>
                            </div>
                        ` : ''}
                        
                        <!-- Menu Items -->
                        <nav class="space-y-1">
                            ${menuItems.filter(item => item.show).map(item => `
                                <button 
                                    onclick="navigateTo('${item.view}')"
                                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 transition-all ${
                                        state.view === item.view ? 'bg-indigo-50 text-indigo-600 font-medium' : ''
                                    }">
                                    <span class="text-xl">${item.icon}</span>
                                    <span>${item.label}</span>
                                </button>
                            `).join('')}
                        </nav>
                        
                        <!-- Support Link -->
                        <div class="mt-8 pt-8 border-t border-gray-200">
                            <a href="https://ko-fi.com/shorecast" target="_blank"
                                class="flex items-center justify-center gap-2 w-full py-3 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-xl font-medium hover:opacity-90 transition-all">
                                <span>‚òï</span>
                                <span>buy us a coffee</span>
                            </a>
                        </div>
                        
                        <!-- Sign Out -->
                        ${state.user ? `
                            <button onclick="signOut()" 
                                class="w-full mt-4 py-3 text-gray-500 hover:text-gray-700 text-sm">
                                sign out
                            </button>
                        ` : ''}
                        
                        <!-- Footer -->
                        <div class="mt-8 pt-8 border-t border-gray-200 text-center">
                            <p class="text-xs text-gray-400">made in South Wales üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // RENDER FUNCTIONS - AUTH VIEWS
        // ============================================

        function renderLoading() {
            return `
                <div class="min-h-screen flex items-center justify-center">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-500">loading shorecast...</p>
                    </div>
                </div>
            `;
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center py-12 px-4 fade-in">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">shorecast</h1>
                            <p class="text-gray-500">your beaches, one glance</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-xl font-medium text-gray-900 mb-6">welcome back</h2>
                            
                            ${state.authError ? `
                                <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                                    <p class="text-red-600 text-sm">${state.authError}</p>
                                </div>
                            ` : ''}
                            
                            <form onsubmit="handleLogin(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">email</label>
                                    <input type="email" id="login-email" required
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
                                        placeholder="you@example.com">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">password</label>
                                    <input type="password" id="login-password" required
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                                
                                <button type="submit" 
                                    class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-medium hover:opacity-90 transition-all disabled:opacity-50"
                                    ${state.authLoading ? 'disabled' : ''}>
                                    ${state.authLoading ? 'signing in...' : 'sign in'}
                                </button>
                            </form>
                            
                            <div class="mt-4 text-center">
                                <button onclick="setState({ view: 'forgot-password', authError: null })" 
                                    class="text-sm text-indigo-600 hover:text-indigo-700">
                                    forgot password?
                                </button>
                            </div>
                            
                            <p class="mt-6 text-center text-sm text-gray-500">
                                don't have an account? 
                                <button onclick="setState({ view: 'signup', authError: null })" class="text-indigo-600 hover:text-indigo-700 font-medium">
                                    sign up
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSignup() {
            return `
                <div class="min-h-screen flex items-center justify-center py-12 px-4 fade-in">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">shorecast</h1>
                            <p class="text-gray-500">your beaches, one glance</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-xl font-medium text-gray-900 mb-6">create account</h2>
                            
                            ${state.authError ? `
                                <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                                    <p class="text-red-600 text-sm">${state.authError}</p>
                                </div>
                            ` : ''}
                            
                            <form onsubmit="handleSignup(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">email</label>
                                    <input type="email" id="signup-email" required
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
                                        placeholder="you@example.com">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">password</label>
                                    <input type="password" id="signup-password" required minlength="6"
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    <p class="text-xs text-gray-500 mt-1">minimum 6 characters</p>
                                </div>
                                
                                <div class="flex items-start">
                                    <input type="checkbox" id="signup-marketing" 
                                        class="mt-1 w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <label for="signup-marketing" class="ml-2 text-sm text-gray-600">
                                        send me occasional updates about new features
                                    </label>
                                </div>
                                
                                <button type="submit" 
                                    class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-medium hover:opacity-90 transition-all disabled:opacity-50"
                                    ${state.authLoading ? 'disabled' : ''}>
                                    ${state.authLoading ? 'creating account...' : 'create account'}
                                </button>
                            </form>
                            
                            <p class="mt-4 text-xs text-gray-500 text-center">
                                by signing up, you agree to our terms of service and privacy policy
                            </p>
                            
                            <p class="mt-6 text-center text-sm text-gray-500">
                                already have an account? 
                                <button onclick="setState({ view: 'login', authError: null })" class="text-indigo-600 hover:text-indigo-700 font-medium">
                                    sign in
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderForgotPassword() {
            return `
                <div class="min-h-screen flex items-center justify-center py-12 px-4 fade-in">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">shorecast</h1>
                            <p class="text-gray-500">reset your password</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-xl font-medium text-gray-900 mb-6">forgot password</h2>
                            
                            ${state.authError ? `
                                <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                                    <p class="text-red-600 text-sm">${state.authError}</p>
                                </div>
                            ` : ''}
                            
                            <p class="text-gray-600 text-sm mb-6">
                                enter your email and we'll send you a link to reset your password
                            </p>
                            
                            <form onsubmit="handleResetPassword(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">email</label>
                                    <input type="email" id="reset-email" required
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
                                        placeholder="you@example.com">
                                </div>
                                
                                <button type="submit" 
                                    class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-medium hover:opacity-90 transition-all disabled:opacity-50"
                                    ${state.authLoading ? 'disabled' : ''}>
                                    ${state.authLoading ? 'sending...' : 'send reset link'}
                                </button>
                            </form>
                            
                            <p class="mt-6 text-center text-sm text-gray-500">
                                <button onclick="setState({ view: 'login', authError: null })" class="text-indigo-600 hover:text-indigo-700 font-medium">
                                    back to sign in
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCheckEmail() {
            return `
                <div class="min-h-screen flex items-center justify-center py-12 px-4 fade-in">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">shorecast</h1>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            
                            <h2 class="text-xl font-medium text-gray-900 mb-4">check your email</h2>
                            <p class="text-gray-600 mb-6">
                                we've sent you a confirmation link. click it to complete your signup.
                            </p>
                            
                            <button onclick="setState({ view: 'login' })" 
                                class="text-indigo-600 hover:text-indigo-700 font-medium">
                                back to sign in
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResetSent() {
            return `
                <div class="min-h-screen flex items-center justify-center py-12 px-4 fade-in">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">shorecast</h1>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            
                            <h2 class="text-xl font-medium text-gray-900 mb-4">reset link sent</h2>
                            <p class="text-gray-600 mb-6">
                                check your email for a link to reset your password.
                            </p>
                            
                            <button onclick="setState({ view: 'login' })" 
                                class="text-indigo-600 hover:text-indigo-700 font-medium">
                                back to sign in
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderOnboarding() {
            const filtered = getFilteredBeaches();
            const isEditing = state.userBeaches.length > 0; // True if user already has beaches
            
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-3xl mx-auto">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">${isEditing ? 'manage your beaches' : 'choose your beaches'}</h1>
                            <p class="text-gray-500">select up to ${MAX_FREE_BEACHES} beaches to track</p>
                            ${isEditing ? `
                                <button onclick="setState({ view: 'dashboard' }); fetchData();" 
                                    class="mt-4 text-sm text-indigo-600 hover:text-indigo-700">
                                    ‚Üê back to dashboard
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <input type="text" 
                                id="beach-search-input"
                                oninput="updateBeachSearch(this.value)"
                                placeholder="search beaches..."
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all">
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 max-h-96 overflow-y-auto">
                            <div class="space-y-2" id="beach-list-container">
                                ${filtered.length === 0 ? `
                                    <p class="text-center text-gray-500 py-8">no beaches found</p>
                                ` : filtered.map(beach => {
                                    const isSelected = state.selectedBeaches.includes(beach.slug);
                                    const canSelect = state.selectedBeaches.length < MAX_FREE_BEACHES;
                                    
                                    return `
                                        <button 
                                            onclick="toggleBeachSelection('${beach.slug}')"
                                            class="w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all ${
                                                isSelected 
                                                    ? 'border-indigo-500 bg-indigo-50' 
                                                    : canSelect 
                                                        ? 'border-gray-200 hover:border-gray-300' 
                                                        : 'border-gray-100 opacity-50 cursor-not-allowed'
                                            }"
                                            ${!isSelected && !canSelect ? 'disabled' : ''}>
                                            <div class="text-left">
                                                <div class="font-medium text-gray-900">${beach.name}</div>
                                                <div class="text-sm text-gray-500">${beach.location}</div>
                                            </div>
                                            ${isSelected ? `
                                                <svg class="w-6 h-6 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                                </svg>
                                            ` : ''}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-gray-600">selected beaches</span>
                                <span class="text-gray-900 font-medium">${state.selectedBeaches.length}/${MAX_FREE_BEACHES}</span>
                            </div>
                            
                            <button 
                                onclick="completeOnboarding()"
                                class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-medium hover:opacity-90 transition-all disabled:opacity-50"
                                ${state.selectedBeaches.length === 0 ? 'disabled' : ''}>
                                ${isEditing ? 'save changes' : 'continue to dashboard'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // RENDER FUNCTIONS - DASHBOARD VIEWS
        // ============================================

        function renderTimeSlots() {
            return state.timeSlots.map(s => `
                <button onclick="setState({ time: '${s.id}' }); fetchData();" 
                    class="flex-shrink-0 min-w-[100px] px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${
                        state.time === s.id 
                            ? 'bg-gray-900 text-white shadow-lg' 
                            : 'bg-white border border-gray-200 text-gray-500 hover:border-gray-300'
                    }">
                    <span class="block">${s.label}</span>
                    <span class="block text-xs opacity-70 mt-0.5">${s.time}</span>
                </button>
            `).join('');
        }

        function renderBeachCard(beach) {
            const rec = beach.recommendation || {};
            const colors = getColors(rec.status);
            const gradient = getGradient(beach.slug);

            return `
                <div class="bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                    <div class="h-52 md:h-64 bg-gradient-to-br ${gradient} relative">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>
                        
                        <span class="absolute top-4 right-4 ${colors.badge} text-white text-xs font-semibold px-3 py-1.5 rounded-full shadow-lg">
                            ${rec.statusText || '...'}
                        </span>

                        ${(() => {
                            // Show sunrise for ALL beaches during morning slots (safety feature)
                            const isMorningSlot = state.time === 'now' || state.time === 'tomorrow-am' || state.time === 'day-after-am';
                            const showSunrise = isMorningSlot && beach.sun?.sunrise;
                            
                            if (showSunrise) {
                                return `
                                    <span class="absolute top-4 left-4 bg-white/95 text-amber-600 text-xs font-semibold px-3 py-1.5 rounded-xl shadow backdrop-blur-sm">
                                        ‚òÄÔ∏è sunrise ${beach.sun.sunrise}
                                    </span>
                                `;
                            }
                            return '';
                        })()}
                        
                        ${(() => {
                            // Show sunset for ALL beaches during evening slots (safety feature)
                            const isEveningSlot = state.time === 'tonight' || state.time === 'tomorrow-pm';
                            const showSunset = isEveningSlot && beach.sun?.sunset;
                            
                            // Check if sunrise is also showing (only for edge case of "now" during dawn)
                            const isMorningSlot = state.time === 'now' || state.time === 'tomorrow-am' || state.time === 'day-after-am';
                            const sunriseShowing = isMorningSlot && beach.sun?.sunrise;
                            
                            if (showSunset) {
                                return `
                                    <span class="absolute ${sunriseShowing ? 'top-14' : 'top-4'} left-4 bg-white/95 text-orange-600 text-xs font-semibold px-3 py-1.5 rounded-xl shadow backdrop-blur-sm">
                                        üåÖ sunset ${beach.sun.sunset}
                                    </span>
                                `;
                            }
                            return '';
                        })()}

                        <div class="absolute bottom-4 left-4 right-4 text-white">
                            <h2 class="text-2xl md:text-3xl font-light mb-1">${beach.name}</h2>
                            <div class="flex items-center gap-2 text-sm opacity-90">
                                <span>${beach.location}</span>
                                ${beach.facing ? `
                                    <span class="bg-white/20 backdrop-blur-sm px-2 py-0.5 rounded text-xs">
                                        ${ARROWS[beach.facing]} ${beach.facing}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="p-5">
                        <div class="grid grid-cols-3 md:grid-cols-5 gap-2 mb-4">
                            <!-- Water temp - both modes -->
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <div class="text-xl font-medium text-gray-900">${beach.seaTempDisplay}</div>
                                <div class="text-xs text-gray-500 mt-1">water</div>
                            </div>
                            
                            <!-- Feels like - both modes -->
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <div class="text-xl font-medium text-gray-900">${beach.weather?.feelsLikeDisplay || '‚Äî'}</div>
                                <div class="text-xs text-gray-500 mt-1">feels like</div>
                            </div>
                            
                            <!-- Tides - both modes -->
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <div class="flex justify-center gap-2">
                                    <div>
                                        <div class="text-base font-medium text-gray-900">${beach.tide?.high || '‚Äî'}</div>
                                        <div class="text-xs text-gray-500">high</div>
                                    </div>
                                    <div class="text-gray-300">|</div>
                                    <div>
                                        <div class="text-base font-medium text-gray-900">${beach.tide?.low || '‚Äî'}</div>
                                        <div class="text-xs text-gray-500">low</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mode-specific stat -->
                            ${state.mode === 'swimming' ? `
                                <div class="text-center p-3 bg-gray-50 rounded-xl">
                                    <div class="text-xl font-medium text-gray-900">${beach.waves?.heightDisplay || '‚Äî'}</div>
                                    <div class="text-xs text-gray-500 mt-1">waves</div>
                                </div>
                            ` : `
                                <div class="text-center p-3 bg-gray-50 rounded-xl">
                                    <div class="text-xl font-medium text-gray-900">${beach.weather?.airTempDisplay || '‚Äî'}</div>
                                    <div class="text-xs text-gray-500 mt-1">air</div>
                                </div>
                            `}
                            
                            <!-- Status - both modes -->
                            <div class="text-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer" onclick="setState({ showInfo: '${beach.slug}' })">
                                <div class="text-xl font-medium text-gray-900">${beach.sewage?.icon || '?'}</div>
                                <div class="text-xs text-gray-500 flex items-center justify-center gap-1 mt-1">
                                    status
                                    <span class="w-4 h-4 bg-gray-300 hover:bg-indigo-500 text-white rounded-full text-xs flex items-center justify-center">i</span>
                                </div>
                            </div>
                        </div>

                        ${beach.isForecast ? `
                            <span class="inline-block bg-indigo-50 text-indigo-600 text-xs font-semibold px-3 py-1 rounded-lg mb-3 border border-indigo-100">
                                forecast
                            </span>
                        ` : ''}

                        ${rec.bestWindow ? `
                            <span class="inline-block bg-indigo-50 text-indigo-600 text-xs font-semibold px-3 py-1 rounded-lg mb-3 border border-indigo-100">
                                best window: ${rec.bestWindow.start} ‚Äì ${rec.bestWindow.end}
                            </span>
                        ` : ''}

                        ${beach.alerts?.jellyfish || beach.alerts?.recentRainfall || beach.alerts?.bathingWaterQuality ? `
                            <div class="flex flex-wrap gap-2 mb-3">
                                ${beach.alerts.jellyfish ? `
                                    <span class="inline-flex items-center gap-1 bg-purple-50 text-purple-600 text-xs font-medium px-2.5 py-1 rounded-lg border border-purple-100">
                                        <span>ü™º</span> ${beach.alerts.jellyfishSpecies || 'jellyfish'} reported nearby
                                    </span>
                                ` : ''}
                                ${beach.alerts.recentRainfall ? `
                                    <span class="inline-flex items-center gap-1 bg-blue-50 text-blue-600 text-xs font-medium px-2.5 py-1 rounded-lg border border-blue-100">
                                        <span>üåßÔ∏è</span> recent rainfall
                                    </span>
                                ` : ''}
                                ${beach.alerts.bathingWaterQuality ? `
                                    <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-lg border
                                        ${beach.alerts.bathingWaterQuality === 'excellent' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :
                                          beach.alerts.bathingWaterQuality === 'good' ? 'bg-green-50 text-green-600 border-green-100' :
                                          beach.alerts.bathingWaterQuality === 'sufficient' ? 'bg-yellow-50 text-yellow-600 border-yellow-100' :
                                          'bg-red-50 text-red-600 border-red-100'}">
                                        <span>üß™</span> ${beach.alerts.bathingWaterQuality}
                                    </span>
                                ` : ''}
                            </div>
                        ` : ''}

                        <div class="p-4 rounded-xl bg-gradient-to-r ${colors.bg} border-l-4 ${colors.border}">
                            <p class="text-gray-600 text-sm leading-relaxed">${formatRecommendation(rec.windowRecommendation || rec.recommendation)}</p>
                        </div>

                        ${beach.sewage?.source ? `
                            <p class="text-xs text-gray-400 mt-2">data: ${beach.sewage.source}</p>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderInfoModal() {
            if (!state.showInfo) return '';
            
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50" onclick="setState({ showInfo: null })"></div>
                <div class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl max-w-md w-11/12 p-6 z-50 max-h-[85vh] overflow-y-auto">
                    <button onclick="setState({ showInfo: null })" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 flex items-center justify-center text-lg">√ó</button>
                    
                    <h3 class="text-xl font-medium text-gray-900 mb-5">what goes into our recommendation</h3>
                    
                    <div class="mb-5">
                        <h4 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3">sewage monitoring</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><span class="inline-block w-6 text-center font-bold text-emerald-600">‚úì</span> clear ‚Äî no discharge in 48 hours</p>
                            <p><span class="inline-block w-6 text-center font-bold text-amber-500">!</span> caution ‚Äî discharge ended 24-48h ago</p>
                            <p><span class="inline-block w-6 text-center font-bold text-red-500">‚úó</span> active ‚Äî currently discharging</p>
                            <p><span class="inline-block w-6 text-center font-bold text-gray-400">?</span> unknown ‚Äî monitoring data unavailable</p>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-100 my-4"></div>
                    
                    <div class="mb-5">
                        <h4 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3">additional factors</h4>
                        <div class="space-y-3 text-sm text-gray-600">
                            <div class="flex gap-3">
                                <span class="text-lg">ü™º</span>
                                <div>
                                    <p class="font-medium text-gray-800">jellyfish sightings</p>
                                    <p class="text-gray-500">based on recent reports near this beach</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <span class="text-lg">üß™</span>
                                <div>
                                    <p class="font-medium text-gray-800">bathing water quality</p>
                                    <p class="text-gray-500">environment agency testing may-september</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <span class="text-lg">üåßÔ∏è</span>
                                <div>
                                    <p class="font-medium text-gray-800">recent rainfall</p>
                                    <p class="text-gray-500">heavy rain affects water quality</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-100 my-4"></div>
                    
                    <div class="text-xs text-gray-400">
                        <p class="mb-1 font-medium text-gray-500">data sources</p>
                        <p>Sewage: UK water companies. Tides: UK Admiralty. Weather & waves: Open-Meteo. Updated every 15 minutes.</p>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            return `
                <div class="max-w-5xl mx-auto px-4 py-8 fade-in">
                    <header class="mb-8">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h1 class="text-4xl md:text-5xl font-light text-gray-900 mb-2">your beaches</h1>
                                <p class="text-gray-400 text-sm">${getUpdateText()}</p>
                            </div>
                            <!-- Menu Button -->
                            <button onclick="toggleSidebar()" 
                                class="w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50 transition-all">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                    </header>

                    <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                        ${renderTimeSlots()}
                    </div>

                    <div class="flex gap-3 mb-8">
                        ${['swimming', 'dipping'].map(m => `
                            <button onclick="setState({ mode: '${m}' }); fetchData();"
                                class="flex-1 py-3 rounded-xl font-medium transition-all ${
                                    state.mode === m ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg' : 'bg-white border border-gray-200 text-gray-500 hover:border-gray-300'
                                }">
                                ${m}
                            </button>
                        `).join('')}
                    </div>

                    ${state.loading ? `
                        <div class="space-y-6">
                            ${[1,2,3].map(() => `
                                <div class="bg-white rounded-2xl overflow-hidden shadow animate-pulse">
                                    <div class="h-52 bg-gray-200"></div>
                                    <div class="p-5"><div class="h-20 bg-gray-100 rounded-xl"></div></div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    ${state.error ? `
                        <div class="bg-red-50 border border-red-200 rounded-2xl p-6 text-center">
                            <p class="text-red-600 mb-2">couldn't load conditions</p>
                            <p class="text-red-400 text-sm mb-4">${state.error}</p>
                            <button onclick="fetchData()" class="px-5 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200">retry</button>
                        </div>
                    ` : ''}

                    ${!state.loading && !state.error && state.data?.beaches ? `
                        <div class="space-y-6 mb-8">
                            ${state.data.beaches.map(b => renderBeachCard(b)).join('')}
                        </div>

                        <div class="bg-white rounded-2xl border-2 border-dashed border-gray-200 p-8 text-center hover:border-indigo-300 transition-all">
                            <p class="text-gray-500 mb-2">free tier: ${state.userBeaches.length}/${MAX_FREE_BEACHES} beaches</p>
                            <p class="text-sm text-gray-400">upgrade for unlimited beaches, forecasts, and more</p>
                        </div>

                        <footer class="mt-12 text-center text-sm text-gray-400">
                            <p class="mb-2">made in South Wales üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø</p>
                            <a href="https://ko-fi.com/shorecast" target="_blank" class="text-indigo-600 hover:text-indigo-700">
                                support shorecast
                            </a>
                        </footer>
                    ` : ''}

                    ${renderInfoModal()}
                    ${renderSidebar()}
                </div>
            `;
        }

        // ============================================
        // RENDER FUNCTIONS - ADDITIONAL PAGES
        // ============================================

        function renderAbout() {
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-3xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-6">about shorecast</h1>
                            
                            <div class="prose prose-gray max-w-none">
                                <p class="text-lg text-gray-600 leading-relaxed mb-6">
                                    We're a husband and wife team in South Wales who swim year-round ‚Äì dawn dips, evening swims, and everything in between.
                                </p>
                                
                                <p class="text-gray-600 leading-relaxed mb-6">
                                    We built Shorecast because we were tired of jumping between tide tables, weather apps, and water company websites just to answer one question: <em>is it a good morning for a swim?</em>
                                </p>
                                
                                <p class="text-gray-600 leading-relaxed mb-6">
                                    Now there's one place that brings it all together ‚Äì and tells you what it means.
                                </p>
                                
                                <h2 class="text-2xl font-light text-gray-900 mt-12 mb-4">what we do</h2>
                                <p class="text-gray-600 leading-relaxed mb-4">
                                    Shorecast pulls live data from tide stations, marine buoys, and water company monitors across Wales and England. Then we make sense of it for you with intelligent recommendations ‚Äì not just raw numbers, but clear answers about when to swim.
                                </p>
                                
                                <h2 class="text-2xl font-light text-gray-900 mt-12 mb-4">our mission</h2>
                                <p class="text-gray-600 leading-relaxed mb-4">
                                    If Shorecast helps you get in the water more often, we've done our job. Wild swimming should be simple, safe, and joyful.
                                </p>
                                
                                <div class="mt-12 p-6 bg-gray-50 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-2">coverage</p>
                                    <p class="text-gray-900 font-medium">99 beaches across Wales and Southwest England</p>
                                    <p class="text-sm text-gray-500 mt-4">more regions coming soon</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        function renderFAQs() {
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-3xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-8">frequently asked questions</h1>
                            
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">how much does shorecast cost?</h3>
                                    <p class="text-gray-600 leading-relaxed">The core service is free. If you find it helpful, you can support us via Ko-fi. We also feature affiliate links to wild swimming gear we use.</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">how accurate is the data?</h3>
                                    <p class="text-gray-600 leading-relaxed">We pull from official sources: UK Admiralty tide predictions, marine weather buoys, and water company monitoring systems. Tide times are reliable. Sea temperature and wave data come from the nearest offshore buoys.</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">which beaches are covered?</h3>
                                    <p class="text-gray-600 leading-relaxed">99 beaches across Wales and Southwest England. From Anglesey to Brighton, covering the entire Welsh coast plus Cornwall, Devon, Dorset, and Sussex.</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">what does "our recommendation" mean?</h3>
                                    <p class="text-gray-600 leading-relaxed">We score conditions based on sewage alerts, weather, wave height, tide timing, and beach orientation. Then we give you a simple verdict: green (looks great), amber (check the details), or red (probably skip it).</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">what counts as "active sewage discharge"?</h3>
                                    <p class="text-gray-600 leading-relaxed">An overflow that's currently releasing untreated wastewater into the sea. Water companies monitor these in real-time and we pull that data directly.</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">can I trust the sewage data?</h3>
                                    <p class="text-gray-600 leading-relaxed">We show you exactly what the water companies are reporting. The monitoring is a legal requirement and generally reliable, but systems can go offline or have delays.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        function renderProfile() {
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-3xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-8">your profile</h1>
                            
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">email</label>
                                    <div class="px-4 py-3 bg-gray-50 rounded-xl text-gray-600">
                                        ${state.user?.email || '‚Äî'}
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">your beaches</label>
                                    <div class="space-y-2 mb-4">
                                        ${state.userBeaches.map((slug, i) => {
                                            const beach = state.availableBeaches.find(b => b.slug === slug);
                                            return beach ? `
                                                <div class="px-4 py-3 bg-gray-50 rounded-xl flex items-center justify-between">
                                                    <div>
                                                        <div class="font-medium text-gray-900">${beach.name}</div>
                                                        <div class="text-sm text-gray-500">${beach.location}</div>
                                                    </div>
                                                    <span class="text-gray-400">#${i + 1}</span>
                                                </div>
                                            ` : '';
                                        }).join('')}
                                    </div>
                                    <button onclick="startEditingBeaches()" 
                                        class="px-4 py-2 text-sm text-indigo-600 hover:text-indigo-700 border border-indigo-200 rounded-xl hover:bg-indigo-50 transition-all">
                                        manage beaches
                                    </button>
                                </div>
                                
                                <div class="pt-6 border-t border-gray-200">
                                    <p class="text-sm text-gray-500 mb-4">account tier</p>
                                    <div class="px-4 py-3 bg-gray-50 rounded-xl">
                                        <span class="text-gray-900 font-medium">Free</span>
                                        <span class="text-gray-500"> ‚Ä¢ ${state.userBeaches.length}/${MAX_FREE_BEACHES} beaches</span>
                                    </div>
                                    <button onclick="navigateTo('premium')" 
                                        class="mt-4 px-4 py-2 text-sm text-indigo-600 hover:text-indigo-700 border border-indigo-200 rounded-xl hover:bg-indigo-50 transition-all">
                                        upgrade to premium
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        function renderAllBeaches() {
            const filtered = getFilteredBeaches();
            
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-2">all beaches</h1>
                            <p class="text-gray-500 mb-6">99 locations across Wales and Southwest England</p>
                            
                            <input type="text" 
                                id="all-beaches-search"
                                oninput="updateAllBeachesSearch(this.value)"
                                placeholder="search beaches..."
                                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all mb-6">
                            
                            <div id="all-beaches-list" class="grid md:grid-cols-2 gap-3 max-h-96 overflow-y-auto">
                                ${filtered.map(beach => `
                                    <div class="p-4 border border-gray-200 rounded-xl hover:border-indigo-300 hover:bg-indigo-50 transition-all">
                                        <div class="font-medium text-gray-900">${beach.name}</div>
                                        <div class="text-sm text-gray-500">${beach.location}</div>
                                        <div class="text-xs text-gray-400 mt-1">${beach.facing} facing ‚Ä¢ ${beach.region}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        function renderContact() {
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-2xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h1 class="text-4xl font-light text-gray-900 mb-6">get in touch</h1>
                            
                            <p class="text-gray-600 mb-8">
                                We love hearing from swimmers. Whether you've found a bug, want to suggest a beach, or just want to say hello.
                            </p>
                            
                            <div class="space-y-6">
                                <a href="mailto:hello@shorecast.co.uk" 
                                    class="flex items-center gap-3 p-4 border border-gray-200 rounded-xl hover:border-indigo-300 hover:bg-indigo-50 transition-all">
                                    <span class="text-2xl">‚úâÔ∏è</span>
                                    <div>
                                        <div class="font-medium text-gray-900">email us</div>
                                        <div class="text-sm text-gray-500">hello@shorecast.co.uk</div>
                                    </div>
                                </a>
                                
                                <a href="https://ko-fi.com/shorecast" target="_blank"
                                    class="flex items-center gap-3 p-4 border border-gray-200 rounded-xl hover:border-indigo-300 hover:bg-indigo-50 transition-all">
                                    <span class="text-2xl">‚òï</span>
                                    <div>
                                        <div class="font-medium text-gray-900">support shorecast</div>
                                        <div class="text-sm text-gray-500">buy us a coffee on ko-fi</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        function renderPremium() {
            return `
                <div class="min-h-screen py-12 px-4 fade-in">
                    <div class="max-w-3xl mx-auto">
                        <div class="mb-6">
                            <button onclick="navigateTo('dashboard')" 
                                class="text-indigo-600 hover:text-indigo-700 text-sm mb-4">
                                ‚Üê back to dashboard
                            </button>
                            <button onclick="toggleSidebar()" 
                                class="float-right w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 hover:bg-gray-50">
                                <div class="w-5 flex flex-col gap-1">
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                    <div class="h-0.5 bg-gray-600 rounded"></div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                            <div class="inline-block p-4 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl mb-6">
                                <span class="text-4xl">‚≠ê</span>
                            </div>
                            
                            <h1 class="text-4xl font-light text-gray-900 mb-4">shorecast premium</h1>
                            <p class="text-gray-500 mb-8">coming soon</p>
                            
                            <div class="max-w-md mx-auto text-left space-y-4 mb-8">
                                <div class="flex items-start gap-3">
                                    <span class="text-emerald-500 mt-1">‚úì</span>
                                    <div>
                                        <div class="font-medium text-gray-900">unlimited beaches</div>
                                        <div class="text-sm text-gray-500">track all your favorite spots</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-emerald-500 mt-1">‚úì</span>
                                    <div>
                                        <div class="font-medium text-gray-900">7-day forecasts</div>
                                        <div class="text-sm text-gray-500">plan your week ahead</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-emerald-500 mt-1">‚úì</span>
                                    <div>
                                        <div class="font-medium text-gray-900">push notifications</div>
                                        <div class="text-sm text-gray-500">sewage alerts for your beaches</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-emerald-500 mt-1">‚úì</span>
                                    <div>
                                        <div class="font-medium text-gray-900">temperature trends</div>
                                        <div class="text-sm text-gray-500">track coldest days for dipping</div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="text-gray-500 text-sm">
                                We're working on premium features. In the meantime, you can <a href="https://ko-fi.com/shorecast" target="_blank" class="text-indigo-600 hover:text-indigo-700">support us on Ko-fi</a>.
                            </p>
                        </div>
                    </div>
                    ${renderSidebar()}
                </div>
            `;
        }

        // Helper function for All Beaches search
        function updateAllBeachesSearch(value) {
            const container = document.getElementById('all-beaches-list');
            if (!container) return;
            
            const filtered = getFilteredBeaches(value);
            container.innerHTML = filtered.map(beach => `
                <div class="p-4 border border-gray-200 rounded-xl hover:border-indigo-300 hover:bg-indigo-50 transition-all">
                    <div class="font-medium text-gray-900">${beach.name}</div>
                    <div class="text-sm text-gray-500">${beach.location}</div>
                    <div class="text-xs text-gray-400 mt-1">${beach.facing} facing ‚Ä¢ ${beach.region}</div>
                </div>
            `).join('');
        }

        // ============================================
        // MAIN RENDER FUNCTION
        // ============================================

        function render() {
            const app = document.getElementById('app');
            
            switch (state.view) {
                case 'loading':
                    app.innerHTML = renderLoading();
                    break;
                case 'login':
                    app.innerHTML = renderLogin();
                    break;
                case 'signup':
                    app.innerHTML = renderSignup();
                    break;
                case 'forgot-password':
                    app.innerHTML = renderForgotPassword();
                    break;
                case 'check-email':
                    app.innerHTML = renderCheckEmail();
                    break;
                case 'reset-sent':
                    app.innerHTML = renderResetSent();
                    break;
                case 'onboarding':
                    app.innerHTML = renderOnboarding();
                    break;
                case 'dashboard':
                    app.innerHTML = renderDashboard();
                    break;
                case 'about':
                    app.innerHTML = renderAbout();
                    break;
                case 'faqs':
                    app.innerHTML = renderFAQs();
                    break;
                case 'profile':
                    app.innerHTML = renderProfile();
                    break;
                case 'all-beaches':
                    app.innerHTML = renderAllBeaches();
                    break;
                case 'contact':
                    app.innerHTML = renderContact();
                    break;
                case 'premium':
                    app.innerHTML = renderPremium();
                    break;
                default:
                    app.innerHTML = renderLoading();
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                setState({ user: session.user });
                loadUserProfile();
            } else if (event === 'SIGNED_OUT') {
                setState({ 
                    user: null, 
                    userProfile: null, 
                    userBeaches: [],
                    view: 'login',
                    data: null
                });
            }
        });

        // Initial auth check
        checkAuth();
    </script>
</body>
</html>
